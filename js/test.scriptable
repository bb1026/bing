{
  "script" : "this.name = \"\u97F3\u4E50\u4E0B\u8F7D\";\r\nthis.widget_ID = \"js-106\";\r\nthis.version = \"v1.5\";\r\n\r\n\/\/ \u68C0\u67E5\u66F4\u65B0\r\nawait CheckKu();\r\nconst { installation } = importModule(\'Ku\');\r\nawait installation(this.widget_ID, this.version);\r\n\r\n\/*\u00A0\r\n\u4EE5\u4E0A\u4E3A\u83B7\u53D6\u66F4\u65B0\u4EE3\u7801\r\n\u4EE5\u4E0B\u5F00\u59CB\u8FD0\u884C\u4EE3\u7801\r\n*\/\r\n\r\nconst url = \"https:\/\/www.fangpi.net\/s\/\";\r\n\r\n\/\/ \u5F39\u51FA\u8F93\u5165\u6846\u8BA9\u7528\u6237\u8F93\u5165\u6B4C\u66F2\u540D\u79F0\u6216\u8005\u6B4C\u624B\r\nconst inputAlert = new Alert();\r\ninputAlert.title = \"\u6B4C\u66F2\u67E5\u627E\";\r\ninputAlert.message = \"\u8BF7\u8F93\u5165\u8981\u67E5\u627E\u7684\u6B4C\u66F2\u6216\u8005\u6B4C\u624B\";\r\ninputAlert.addTextField(\"\u6B4C\u66F2\u6216\u8005\u6B4C\u624B\", \"\");\r\ninputAlert.addAction(\"\u786E\u5B9A\");\r\ninputAlert.addCancelAction(\"\u53D6\u6D88\");\r\nconst inputResult = await inputAlert.present();\r\n\r\n\/\/ \u5982\u679C\u7528\u6237\u70B9\u51FB\u4E86\u786E\u5B9A\uFF0C\u5219\u83B7\u53D6\u8F93\u5165\u7684\u6B4C\u66F2\u6216\u8005\u6B4C\u624B\r\nlet musicName;\r\nif (inputResult === 0) {\r\n  musicName = inputAlert.textFieldValue(0).trim();\r\n} else {\r\n  console.log(\"\u7528\u6237\u53D6\u6D88\u4E86\u8F93\u5165\u3002\");\r\n  return;\r\n}\r\n\r\n\/\/ \u521B\u5EFA\u8BF7\u6C42\r\nconst req = new Request(url + encodeURIComponent(musicName));\r\nconst htmlText = await req.loadString();\r\n\r\n\/\/ \u6B63\u5219\u8868\u8FBE\u5F0F\u5339\u914D\u6B4C\u66F2\u4FE1\u606F\r\nconst songRegex = \/<div class=\"col-8 col-content\">.*?<a href=\"\\\/music\\\/([^\"]+)\"[^>]*>.*?<span[^>]*class=\"text-primary[^>]*>.*?<span>(.*?)<\\\/span>.*?<\\\/span>.*?<small[^>]*>(.*?)<\\\/small>\/gs;\r\nconst matches = [...htmlText.matchAll(songRegex)];\r\n\r\n\/\/ \u521B\u5EFA\u6570\u636E\u6570\u7EC4\r\nconst musicData = matches.map(match => ({\r\n  href: match[1].trim(),\r\n  song_title: match[2].trim(),\r\n  singer: match[3].replace(\/amp;\/g, \'\').trim()\r\n}));\r\n\r\n\/\/ \u521B\u5EFA UITable\r\nlet table = new UITable();\r\ntable.showSeparators = true;\r\n\r\n\/\/ \u6DFB\u52A0\u6807\u9898\u884C\r\nlet headerRow = new UITableRow();\r\nheaderRow.isHeader = true;\r\nheaderRow.addCell(UITableCell.text(\"\u6B4C\u66F2\u6807\u9898\"));\r\nheaderRow.addCell(UITableCell.text(\"\u6B4C\u624B\"));\r\ntable.addRow(headerRow);\r\n\r\n\/\/ \u6DFB\u52A0\u6570\u636E\u884C\r\nfor (let item of musicData) {\r\n  let dataRow = new UITableRow();\r\n  dataRow.addCell(UITableCell.text(item.song_title));\r\n  dataRow.addCell(UITableCell.text(item.singer));\r\n \u00A0\r\n  dataRow.onSelect = async () => {\r\n    if (item.href) {\r\n      const MP3URL = `https:\/\/www.fangpi.net\/music\/${item.href}`;\r\n      console.log(`\u66F2\u540D:${item.song_title}, \u6B4C\u624B:${item.singer}, \u94FE\u63A5:${MP3URL}`);\r\n        Safari.open(`quark:\/\/${MP3URL}`);\r\n    }\r\n  };\r\n \u00A0\r\n  table.addRow(dataRow);\r\n}\r\n\r\nasync function CheckKu() {\r\n  const notification = new Notification();\r\n  const fm = FileManager.local();\r\n  const KuName = \"Ku.js\";\r\n  const scriptPath = fm.joinPath(fm.documentsDirectory(), KuName);\r\n  const scriptExists = fm.fileExists(scriptPath);\r\n\r\n  if (!scriptExists) {\r\n    try {\r\n      const downloadReq = new Request(\"https:\/\/bb1026.github.io\/bing\/js\/Ku.js\");\r\n      const scriptContent = await downloadReq.loadString();\r\n      await fm.writeString(scriptPath, scriptContent);\r\n\r\n      notification.title = \"\u4F9D\u8D56\u5E93\u5B89\u88C5\u5B8C\u6210!\";\r\n      await notification.schedule();\r\n      console.log(\"\u4F9D\u8D56\u5E93\u5B89\u88C5\u5B8C\u6210!\");\r\n    } catch (error) {\r\n      console.error(\"\u4E0B\u8F7D\u6216\u5199\u5165\u6587\u4EF6\u65F6\u51FA\u9519:\", error);\r\n      notification.title = \"\u4F9D\u8D56\u5E93\u5B89\u88C5\u5931\u8D25!\";\r\n      notification.body = error.toString();\r\n      await notification.schedule();\r\n    }\r\n  } else {\r\n    console.log(\"\u4F9D\u8D56\u5E93\u5DF2\u5B58\u5728\uFF0C\u65E0\u9700\u4E0B\u8F7D\u3002\");\r\n  }\r\n}\r\n\r\n\/\/ \u663E\u793A\u8868\u683C\r\nawait table.present();",
  "icon" : {
    "color" : "cyan",
    "glyph" : "theater-masks"
  },
  "share_sheet_inputs" : [

  ],
  "name" : "Master List",
  "always_run_in_app" : false
}